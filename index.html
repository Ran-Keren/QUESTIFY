<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Questify Game</title>
<style>
  html, body {
    margin:0; padding:0;
    height:100%; width:100%;
    display:flex; justify-content:center; align-items:center;
    font-family:Arial, sans-serif; text-align:center;
    background:#fff; color:#222; flex-direction:column;
  }
  .hidden { display:none; }
  button {
    margin-top:20px;
    padding:10px 20px;
    font-size:1.2rem;
    border:none; border-radius:10px;
    background:#e94e77; color:white;
    cursor:pointer;
  }
  button:hover { background:#c53e63; }
  input {
    font-size:1.2rem; padding:10px;
    border-radius:10px; border:2px solid #333;
    text-align:center; width:150px;
  }
</style>
</head>
<body>

<!-- Level 1: Logo -->
<div id="level1">
  <div style="font-size:3rem; color:red; font-weight:bold;">ðŸ”’ Questify</div>
  <button id="startBtn">Let's Start</button>
</div>

<!-- Level 2: Rules + mic permission -->
<div id="level2" class="hidden">
  <h2>Rules</h2>
  <p>1. You can use whatever you want.<br>
     2. You can't ask me for help.<br>
     3. There is no time limit.</p>
  <button id="micBtn">Allow Microphone</button>
  <button id="continueBtn" class="hidden">Start</button>
</div>

<!-- Level 3: Color input (full-page background) -->
<div id="level3" class="hidden" 
     style="background:#00ff66; 
            width:100vw; 
            height:100vh; 
            display:flex; 
            flex-direction:column; 
            justify-content:center; 
            align-items:center;">
  <input id="colorInput" type="text" placeholder="" />
  <button id="submitColor">Submit</button>
</div>

<!-- Level 4: Double tap detection -->
<div id="level4" class="hidden" 
     style="width:100vw; height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; background:#eee;">
  <h2>ðŸ‘† Double tap to continue...</h2>
  <p id="tapStatus"></p>
</div>

<!-- Level 5: Success -->
<div id="level5" class="hidden">
  <h2>ðŸŽ‰ You passed the double-tap level!</h2>
</div>

<script>
const l1 = document.getElementById("level1");
const l2 = document.getElementById("level2");
const l3 = document.getElementById("level3");
const l4 = document.getElementById("level4");
const l5 = document.getElementById("level5");

const startBtn = document.getElementById("startBtn");
const micBtn = document.getElementById("micBtn");
const continueBtn = document.getElementById("continueBtn");

const colorInput = document.getElementById("colorInput");
const submitColor = document.getElementById("submitColor");

const tapStatus = document.getElementById("tapStatus");

const targetColor = '#00ff66';

// --- Level 1 ---
startBtn.onclick = () => {
  l1.classList.add("hidden");
  l2.classList.remove("hidden");
};

// --- Level 2: Mic permission ---
micBtn.onclick = async () => {
  try {
    // Mic permission requested but no feedback needed
    await navigator.mediaDevices.getUserMedia({ audio: true });
    micBtn.classList.add("hidden");
    continueBtn.classList.remove("hidden");
  } catch (err) {
    console.error(err);
    alert("Microphone access denied or unavailable.");
  }
};

continueBtn.onclick = () => {
  l2.classList.add("hidden");
  l3.classList.remove("hidden");
};

// --- Level 3: Color input ---
submitColor.onclick = () => {
  const guess = colorInput.value.trim();
  const normalized = guess.startsWith('#') ? guess : '#' + guess;
  if (normalized.toLowerCase() === targetColor.toLowerCase()) {
    l3.classList.add("hidden");
    l4.classList.remove("hidden");
    startDoubleTapDetection();
  } else {
    alert("âŒ Wrong color! Try again.");
  }
};

// --- Level 4: Double tap detection ---
function startDoubleTapDetection() {
  let lastTapTime = 0;
  const maxInterval = 400; // max ms between taps for double tap

  l4.addEventListener("touchstart", () => {
    const now = Date.now();
    if (now - lastTapTime <= maxInterval) {
      tapStatus.textContent = "ðŸ‘† Double tap detected!";
      setTimeout(() => {
        l4.classList.add("hidden");
        l5.classList.remove("hidden");
      }, 300);
    } else {
      tapStatus.textContent = "ðŸ‘† First tap detected!";
    }
    lastTapTime = now;
  });

  // Optional: also detect mouse click for desktop
  l4.addEventListener("click", () => {
    const now = Date.now();
    if (now - lastTapTime <= maxInterval) {
      tapStatus.textContent = "ðŸ‘† Double tap detected!";
      setTimeout(() => {
        l4.classList.add("hidden");
        l5.classList.remove("hidden");
      }, 300);
    } else {
      tapStatus.textContent = "ðŸ‘† First tap detected!";
    }
    lastTapTime = now;
  });
}
</script>

</body>
</html>
